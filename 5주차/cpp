#include <iostream>
#include <vector>
#include <ctime>
#include <cstdlib>
#include <windows.h>
#include <iomanip>
#include <string>

using namespace std;

const string UNOPENED = "â–¡";
const string MINE = "*";

// ë°©í–¥ ë²¡í„°: ìƒí•˜ì¢Œìš° + ëŒ€ê°ì„ 
int dx[] = { -1, -1, -1, 0, 1, 1, 1, 0 };
int dy[] = { -1, 0, 1, 1, 1, 0, -1, -1 };

// ì½˜ì†” UTF-8 ì¶œë ¥ ì„¤ì •
void setupConsole() {
    SetConsoleOutputCP(65001);
    SetConsoleCP(65001);
}

// ë§µ ì¶œë ¥ í•¨ìˆ˜
void printMap(const vector<vector<string>>& display) {
    int height = display.size();
    int width = display[0].size();

    cout << "\n   ";
    for (int j = 0; j < width; ++j)
        cout << setw(3) << j;
    cout << endl;

    for (int i = 0; i < height; ++i) {
        cout << setw(3) << i;
        for (int j = 0; j < width; ++j)
            cout << setw(3) << display[i][j];
        cout << endl;
    }
}

// ì§€ë¢° ì£¼ë³€ ê°œìˆ˜ ì„¸ê¸°
int countAdjacentMines(int x, int y, const vector<vector<string>>& map) {
    int count = 0;
    int height = map.size();
    int width = map[0].size();

    for (int d = 0; d < 8; ++d) {
        int nx = x + dx[d];
        int ny = y + dy[d];
        if (nx >= 0 && nx < height && ny >= 0 && ny < width) {
            if (map[nx][ny] == MINE)
                count++;
        }
    }
    return count;
}

// ì§€ë¢° ë°°ì¹˜
void placeMines(vector<vector<string>>& map, int numMines) {
    int height = map.size();
    int width = map[0].size();
    srand((unsigned int)time(0));

    int placed = 0;
    while (placed < numMines) {
        int x = rand() % height;
        int y = rand() % width;
        if (map[x][y] != MINE) {
            map[x][y] = MINE;
            placed++;
        }
    }
}

int main() {
    setupConsole();

    int width, height, numMines;
    cout << "ì§€ë¢°ë§µì˜ ê°€ë¡œ í¬ê¸°(ìµœëŒ€ 80): ";
    cin >> width;
    cout << "ì§€ë¢°ë§µì˜ ì„¸ë¡œ í¬ê¸°(ìµœëŒ€ 40): ";
    cin >> height;
    cout << "ë§¤ì„¤í•  ì§€ë¢°ì˜ ê°œìˆ˜: ";
    cin >> numMines;

    cout << "\nì„¤ì • ì™„ë£Œ! " << width << "x" << height << " ë§µì— ì§€ë¢° " << numMines << "ê°œë¥¼ ë§¤ì„¤í•©ë‹ˆë‹¤.\n";

    // ë§µ ì´ˆê¸°í™”
    vector<vector<string>> map(height, vector<string>(width, " "));
    vector<vector<string>> display(height, vector<string>(width, UNOPENED));
    vector<vector<bool>> opened(height, vector<bool>(width, false));

    placeMines(map, numMines);

    // ìˆ«ì ì±„ìš°ê¸°
    for (int i = 0; i < height; ++i)
        for (int j = 0; j < width; ++j)
            if (map[i][j] != MINE)
                map[i][j] = to_string(countAdjacentMines(i, j, map));

    int safeCells = width * height - numMines;
    int openedCount = 0;

    while (true) {
        printMap(display);
        cout << "\nì—´ ì¢Œí‘œì™€ í–‰ ì¢Œí‘œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1 3): ";
        int x, y;
        cin >> y >> x;

        if (x < 0 || x >= width || y < 0 || y >= height) {
            cout << "â— ì˜ëª»ëœ ì¢Œí‘œì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.\n";
            continue;
        }

        if (opened[y][x]) {
            cout << "âš ï¸ ì´ë¯¸ ì—´ë¦° ì¹¸ì…ë‹ˆë‹¤.\n";
            continue;
        }

        opened[y][x] = true;

        if (map[y][x] == MINE) {
            cout << "\nğŸ’¥ ì§€ë¢°ë¥¼ ë°Ÿì•˜ìŠµë‹ˆë‹¤! ê²Œì„ ì˜¤ë²„!\n";
            for (int i = 0; i < height; ++i)
                for (int j = 0; j < width; ++j)
                    if (map[i][j] == MINE)
                        display[i][j] = MINE;
            printMap(display);
            break;
        } else {
            display[y][x] = map[y][x];
            openedCount++;
            if (openedCount == safeCells) {
                cout << "\nğŸ‰ ëª¨ë“  ì•ˆì „í•œ ì¹¸ì„ ì—´ì—ˆìŠµë‹ˆë‹¤! ìŠ¹ë¦¬!\n";
                printMap(display);
                break;
            }
        }
    }

    return 0;
}
